<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Protain</th>
      <th>Quantity</th>
      <th>Unit</th>
      <th>Ate</th>
      <th>date</th>
    </tr>
  </thead>

  <tbody>
    <% if @records != nil %>
      <% date = "" %>
      <% protain_amount = 0 %>
      <% @records.each do |record| %>
        <% food = Food.find(record.food_id) %>
        <% protain_amount += (food.protain * record.ate) %>
        <% before_day = date if record != @records.first %>
        <% date = record.record_on %>
        <tr>
          <td><%= food.name %></td>
          <td><%= food.protain %></td>
          <td><%= food.quantity %></td>
          <td><%= food.unit %></td>
          <td><%= record.ate %></td>
          <td><%= record.record_on %></td>
          <td><%= link_to 'Show', record %></td>
          <td><%= link_to 'Edit', edit_record_path(record.id) %></td>
          <td><%= link_to 'Destroy', record_path(record.id), method: :delete, data: { confirm: 'Are you sure?' } %></td>
        </tr>
        <% if date != before_day %>
          <tr>
            <%= "#{date}のタンパク質摂取量合計" %><%= protain_amount %><%= "g" %>
            <% protain_amount = 0 %>
          </tr>
        <% end %>
      <% end %>
    <% end %>
  </tbody>
</table>
